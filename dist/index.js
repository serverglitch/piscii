(()=>{var R=Object.create;var v=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var $=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var N=(e,a)=>()=>(a||e((a={exports:{}}).exports,a),a.exports);var q=(e,a,d,s)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of O(a))!j.call(e,n)&&n!==d&&v(e,n,{get:()=>a[n],enumerable:!(s=T(a,n))||s.enumerable});return e};var B=(e,a,d)=>(d=e!=null?R($(e)):{},q(a||!e||!e.__esModule?v(d,"default",{value:e,enumerable:!0}):d,e));var L=N((x,p)=>{(function(e){function a(f,r){if(f=s(f),!f)return null;var o,u=1/0,t,c;r||(r=a.DEFAULT_COLORS);for(var g=0;g<r.length;++g)t=r[g].rgb,o=Math.pow(f.r-t.r,2)+Math.pow(f.g-t.g,2)+Math.pow(f.b-t.b,2),o<u&&(u=o,c=r[g]);return c.name?{name:c.name,value:c.source,rgb:c.rgb,distance:Math.sqrt(u)}:c.source}a.from=function f(r){var o=d(r),u=a,t=function(g){return u(g,o)};return t.from=f,t.or=function(g){var M=o.concat(d(g));return a.from(M)},t};function d(f){return f instanceof Array?f.map(function(r){return n(r)}):Object.keys(f).map(function(r){return n(f[r],r)})}function s(f){var r,o,u;if(typeof f=="object")return f;if(f in a.STANDARD_COLORS)return s(a.STANDARD_COLORS[f]);var t=f.match(/^#?((?:[0-9a-f]{3}){1,2})$/i);if(t)return t=t[1],t.length===3?t=[t.charAt(0)+t.charAt(0),t.charAt(1)+t.charAt(1),t.charAt(2)+t.charAt(2)]:t=[t.substring(0,2),t.substring(2,4),t.substring(4,6)],r=parseInt(t[0],16),o=parseInt(t[1],16),u=parseInt(t[2],16),{r,g:o,b:u};var c=f.match(/^rgb\(\s*(\d{1,3}%?),\s*(\d{1,3}%?),\s*(\d{1,3}%?)\s*\)$/i);if(c)return r=l(c[1]),o=l(c[2]),u=l(c[3]),{r,g:o,b:u};throw Error('"'+f+'" is not a valid color')}function n(f,r){var o={};if(r&&(o.name=r),typeof f=="string")o.source=f,o.rgb=s(f);else if(typeof f=="object"){if(f.source)return n(f.source,f.name);o.rgb=f,o.source=m(f)}return o}function l(f){return f.charAt(f.length-1)==="%"?Math.round(parseInt(f,10)*255/100):Number(f)}function m(f){return"#"+i(f.r.toString(16))+i(f.g.toString(16))+i(f.b.toString(16))}function i(f){return f.length===1&&(f="0"+f),f}a.STANDARD_COLORS={aqua:"#0ff",black:"#000",blue:"#00f",fuchsia:"#f0f",gray:"#808080",green:"#008000",lime:"#0f0",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",purple:"#800080",red:"#f00",silver:"#c0c0c0",teal:"#008080",white:"#fff",yellow:"#ff0"},a.DEFAULT_COLORS=d(["#f00","#f80","#ff0","#0f0","#00f","#008","#808"]),a.VERSION="0.4.4",typeof p=="object"&&p&&p.exports?p.exports=a:e.nearestColor=a})(x)});var y={"016":"000000","017":"00005f","018":"000087","019":"0000af","020":"0000d7","021":"0000ff","022":"005f00","023":"005f5f","024":"005f87","025":"005faf","026":"005fd7","027":"005fff","028":"008700","029":"00875f","030":"008787","031":"0087af","032":"0087d7","033":"0087ff","034":"00af00","035":"00af5f","036":"00af87","037":"00afaf","038":"00afd7","039":"00afff","040":"00d700","041":"00d75f","042":"00d787","043":"00d7af","044":"00d7d7","045":"00d7ff","046":"00ff00","047":"00ff5f","048":"00ff87","049":"00ffaf","050":"00ffd7","051":"00ffff","052":"5f0000","053":"5f005f","054":"5f0087","055":"5f00af","056":"5f00d7","057":"5f00ff","058":"5f5f00","059":"5f5f5f","060":"5f5f87","061":"5f5faf","062":"5f5fd7","063":"5f5fff","064":"5f8700","065":"5f875f","066":"5f8787","067":"5f87af","068":"5f87d7","069":"5f87ff","070":"5faf00","071":"5faf5f","072":"5faf87","073":"5fafaf","074":"5fafd7","075":"5fafff","076":"5fd700","077":"5fd75f","078":"5fd787","079":"5fd7af","080":"5fd7d7","081":"5fd7ff","082":"5fff00","083":"5fff5f","084":"5fff87","085":"5fffaf","086":"5fffd7","087":"5fffff","088":"870000","089":"87005f","090":"870087","091":"8700af","092":"8700d7","093":"8700ff","094":"875f00","095":"875f5f","096":"875f87","097":"875faf","098":"875fd7","099":"875fff","100":"878700","101":"87875f","102":"878787","103":"8787af","104":"8787d7","105":"8787ff","106":"87af00","107":"87af5f","108":"87af87","109":"87afaf","110":"87afd7","111":"87afff","112":"87d700","113":"87d75f","114":"87d787","115":"87d7af","116":"87d7d7","117":"87d7ff","118":"87ff00","119":"87ff5f","120":"87ff87","121":"87ffaf","122":"87ffd7","123":"87ffff","124":"af0000","125":"af005f","126":"af0087","127":"af00af","128":"af00d7","129":"af00ff","130":"af5f00","131":"af5f5f","132":"af5f87","133":"af5faf","134":"af5fd7","135":"af5fff","136":"af8700","137":"af875f","138":"af8787","139":"af87af","140":"af87d7","141":"af87ff","142":"afaf00","143":"afaf5f","144":"afaf87","145":"afafaf","146":"afafd7","147":"afafff","148":"afd700","149":"afd75f","150":"afd787","151":"afd7af","152":"afd7d7","153":"afd7ff","154":"afff00","155":"afff5f","156":"afff87","157":"afffaf","158":"afffd7","159":"afffff","160":"d70000","161":"d7005f","162":"d70087","163":"d700af","164":"d700d7","165":"d700ff","166":"d75f00","167":"d75f5f","168":"d75f87","169":"d75faf","170":"d75fd7","171":"d75fff","172":"d78700","173":"d7875f","174":"d78787","175":"d787af","176":"d787d7","177":"d787ff","178":"d7af00","179":"d7af5f","180":"d7af87","181":"d7afaf","182":"d7afd7","183":"d7afff","184":"d7d700","185":"d7d75f","186":"d7d787","187":"d7d7af","188":"d7d7d7","189":"d7d7ff","190":"d7ff00","191":"d7ff5f","192":"d7ff87","193":"d7ffaf","194":"d7ffd7","195":"d7ffff","196":"ff0000","197":"ff005f","198":"ff0087","199":"ff00af","200":"ff00d7","201":"ff00ff","202":"ff5f00","203":"ff5f5f","204":"ff5f87","205":"ff5faf","206":"ff5fd7","207":"ff5fff","208":"ff8700","209":"ff875f","210":"ff8787","211":"ff87af","212":"ff87d7","213":"ff87ff","214":"ffaf00","215":"ffaf5f","216":"ffaf87","217":"ffafaf","218":"ffafd7","219":"ffafff","220":"ffd700","221":"ffd75f","222":"ffd787","223":"ffd7af","224":"ffd7d7","225":"ffd7ff","226":"ffff00","227":"ffff5f","228":"ffff87","229":"ffffaf","230":"ffffd7","231":"ffffff","232":"080808","233":"121212","234":"1c1c1c","235":"262626","236":"303030","237":"3a3a3a","238":"444444","239":"4e4e4e","240":"585858","241":"626262","242":"6c6c6c","243":"767676","244":"808080","245":"8a8a8a","246":"949494","247":"9e9e9e","248":"a8a8a8","249":"b2b2b2","250":"bcbcbc","251":"c6c6c6","252":"d0d0d0","253":"dadada","254":"e4e4e4","255":"eeeeee","16-a":"000000","231-z":"ffffff"},I={"016":"000","017":"001","018":"002","019":"003","020":"004","021":"005","022":"010","023":"011","024":"012","025":"013","026":"014","027":"015","028":"020","029":"021","030":"022","031":"023","032":"024","033":"025","034":"030","035":"031","036":"032","037":"033","038":"034","039":"035","040":"040","041":"041","042":"042","043":"043","044":"044","045":"045","046":"050","047":"051","048":"052","049":"053","050":"054","051":"055","052":"100","053":"101","054":"102","055":"103","056":"104","057":"105","058":"110","059":"111","060":"112","061":"113","062":"114","063":"115","064":"120","065":"121","066":"122","067":"123","068":"124","069":"125","070":"130","071":"131","072":"132","073":"133","074":"134","075":"135","076":"140","077":"141","078":"142","079":"143","080":"144","081":"145","082":"150","083":"151","084":"152","085":"153","086":"154","087":"155","088":"200","089":"201","090":"202","091":"203","092":"204","093":"205","094":"210","095":"211","096":"212","097":"213","098":"214","099":"215","100":"220","101":"221","102":"222","103":"223","104":"224","105":"225","106":"230","107":"231","108":"232","109":"233","110":"234","111":"235","112":"240","113":"241","114":"242","115":"243","116":"244","117":"245","118":"250","119":"251","120":"252","121":"253","122":"254","123":"255","124":"300","125":"301","126":"302","127":"303","128":"304","129":"305","130":"310","131":"311","132":"312","133":"313","134":"314","135":"315","136":"320","137":"321","138":"322","139":"323","140":"324","141":"325","142":"330","143":"331","144":"332","145":"333","146":"334","147":"335","148":"340","149":"341","150":"342","151":"343","152":"344","153":"345","154":"350","155":"351","156":"352","157":"353","158":"354","159":"355","160":"400","161":"401","162":"402","163":"403","164":"404","165":"405","166":"410","167":"411","168":"412","169":"413","170":"414","171":"415","172":"420","173":"421","174":"422","175":"423","176":"424","177":"425","178":"430","179":"431","180":"432","181":"433","182":"434","183":"435","184":"440","185":"441","186":"442","187":"443","188":"444","189":"445","190":"450","191":"451","192":"452","193":"453","194":"454","195":"455","196":"500","197":"501","198":"502","199":"503","200":"504","201":"505","202":"510","203":"511","204":"512","205":"513","206":"514","207":"515","208":"520","209":"521","210":"522","211":"523","212":"524","213":"525","214":"530","215":"531","216":"532","217":"533","218":"534","219":"535","220":"540","221":"541","222":"542","223":"543","224":"544","225":"545","226":"550","227":"551","228":"552","229":"553","230":"554","231":"555","232":"=b","233":"=c","234":"=d","235":"=e","236":"=f","237":"=g","238":"=h","239":"=i","240":"=j","241":"=k","242":"=l","243":"=m","244":"=n","245":"=o","246":"=p","247":"=q","248":"=r","249":"=s","250":"=t","251":"=u","252":"=v","253":"=w","254":"=x","255":"=y","16-a":"=a","231-z":"=z"};var w=B(L()),b=document.getElementById("preview"),_=document.getElementById("ascii"),z=document.getElementById("xterm"),S=b.getContext("2d"),A=document.querySelector('input[type="file"]'),H=document.getElementById("scale"),h={width:100,height:100},k=(e,a,d)=>.2126*e+.7152*a+.0722*d,F=()=>{let e=document.createElement("pre");e.style.display="inline",e.textContent=" ",document.body.appendChild(e);let{width:a,height:d}=e.getBoundingClientRect();return document.body.removeChild(e),d/a},U=(e,a)=>{let d=Math.floor(F()*e);return a>h.height?[Math.floor(d*h.height/a),h.height]:e>h.width?[h.width,Math.floor(a*h.width/d)]:[d,a]},V=(e,a,d)=>{let s=e.getImageData(0,0,a,d),n=[],l=[],m=[];for(let i=0;i<s.data.length;i+=4){let f=s.data[i],r=s.data[i+1],o=s.data[i+2],u=s.data[i+3],t=k(f,r,o);s.data[i]=s.data[i+1]=s.data[i+2]=s.data[i+3]=t,n.push(t);let c=w.default.from(y)({r:f,g:r,b:o});m.push(c),l.push(I[c.name])}return e.putImageData(s,0,0),{grayScales:n,pixelColors:m,xTermColors:l}},C=new FileReader,E=()=>{{let e=new Image;e.onload=()=>{let[a,d]=U(e.width,e.height);b.width=a,b.height=d,S.drawImage(e,0,0,a,d);let{grayScales:s,pixelColors:n,xTermColors:l}=V(S,a,d);Z(s,n,l,a),A.value=""},e.src=C.result}};A.onchange=e=>{let a=e.target.files[0];C.onload=E,C.readAsDataURL(a)};var D=" ****########%%%%%%%%%%%@@@@@@@@@@@@@@@@",G=D.length,W=e=>D[Math.ceil((G-1)*e/255)],Z=(e,a,d,s)=>{let n={lines:[],line:"",lastColor:null},l={lines:[],line:"",lastColor:null},m=1e4;e.forEach((i,f)=>{let r=W(i),o=a[f],u=d[f];if(o.value!=="000000"?(l.line+=l.lastColor===u?r:`|${u}${r}`,console.log(n.lastColor,o.value),n.line+=n.lastColor===o.value?r:`${/^\s+$/.exec(n.line)===null?"</span>":""}<span style="color:#${o.value}">${r}`):(l.line+=" ",n.line+=" "),(f+1)%s===0){let t=n.line.search(/\S/);t<m&&t>-1&&(m=t),/^\s+$/.exec(n.line)===null&&(n.lines.push(n.line+"</span>"),l.lines.push(l.line)),l.line="",n.line=""}l.lastColor=u,n.lastColor=o.value}),z.innerText=l.lines.map((i,f)=>(f===0?"|000":"")+i.slice(m).trimEnd().replace(/[ ]/gm,"|_")).join("|/"),_.innerHTML=n.lines.map(i=>i.slice(m).trimEnd()).join(`
`)},J=e=>{h.height=h.width=parseInt(e.target.value),E()};H.addEventListener("change",J);})();
